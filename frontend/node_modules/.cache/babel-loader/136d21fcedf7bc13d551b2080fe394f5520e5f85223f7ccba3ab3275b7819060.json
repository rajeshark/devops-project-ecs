{"ast":null,"code":"import _objectSpread from\"D:/raju new 1/front-end/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _taggedTemplateLiteral from\"D:/raju new 1/front-end/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject0,_templateObject1,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32,_templateObject33,_templateObject34,_templateObject35,_templateObject36,_templateObject37,_templateObject38,_templateObject39,_templateObject40,_templateObject41,_templateObject42,_templateObject43,_templateObject44,_templateObject45,_templateObject46,_templateObject47,_templateObject48;import React,{useState,useEffect,useCallback}from\"react\";import styled from\"styled-components\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{loadStripe}from\"@stripe/stripe-js\";import{Elements,CardNumberElement,CardExpiryElement,CardCvcElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const stripePromise=loadStripe(\"pk_test_51SEWfbGUJ7v3D9GXVs5sPIBEY08wZrpGmeuko8YClRovgbeQkkYJ2NpxLMtM3RyA8v7NSKM4cE8mTLthWafiYGv500lPgVJb3n\");// ========== ALL STYLED COMPONENTS ==========\nconst Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\"])));const Wrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  padding: 20px;\\n  \\n  @media (max-width: 768px) {\\n    padding: 10px;\\n  }\\n\"])));const Title=styled.h1(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  font-weight: 300;\\n  text-align: center;\\n  font-size: 1.5rem;\\n  \\n  @media (min-width: 768px) {\\n    font-size: 2rem;\\n  }\\n\"])));const Top=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 20px;\\n  flex-wrap: wrap;\\n  gap: 15px;\\n  \\n  @media (max-width: 768px) {\\n    padding: 15px 10px;\\n    justify-content: center;\\n  }\\n\"])));const TopButton=styled.button(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  padding: 12px 20px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  border: \",\";\\n  background-color: \",\";\\n  color: \",\";\\n  border-radius: 8px;\\n  font-size: 14px;\\n  min-height: 44px;\\n  \\n  @media (max-width: 480px) {\\n    padding: 10px 15px;\\n    font-size: 12px;\\n    min-height: 40px;\\n  }\\n\"])),props=>props.type===\"filled\"&&\"none\",props=>props.type===\"filled\"?\"black\":\"transparent\",props=>props.type===\"filled\"&&\"white\");const TopTexts=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  display: flex;\\n  gap: 10px;\\n  \\n  @media (max-width: 480px) {\\n    flex-direction: column;\\n    align-items: center;\\n    gap: 5px;\\n  }\\n\"])));const TopText=styled.span(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  text-decoration: underline;\\n  cursor: pointer;\\n  font-size: 14px;\\n  \\n  @media (max-width: 480px) {\\n    font-size: 12px;\\n  }\\n\"])));const Bottom=styled.div(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 20px;\\n  \\n  @media (max-width: 768px) {\\n    flex-direction: column;\\n  }\\n\"])));const Info=styled.div(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  flex: 3;\\n\"])));const Product=styled.div(_templateObject0||(_templateObject0=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  margin-bottom: 20px;\\n  gap: 15px;\\n  \\n  @media (max-width: 768px) {\\n    flex-direction: column;\\n    border: 1px solid #e0e0e0;\\n    border-radius: 10px;\\n    padding: 15px;\\n  }\\n\"])));const ProductDetail=styled.div(_templateObject1||(_templateObject1=_taggedTemplateLiteral([\"\\n  flex: 2;\\n  display: flex;\\n  gap: 15px;\\n  \\n  @media (max-width: 480px) {\\n    flex-direction: column;\\n    text-align: center;\\n  }\\n\"])));const Image=styled.img(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  width: 200px;\\n  height: 200px;\\n  object-fit: cover;\\n  \\n  @media (max-width: 768px) {\\n    width: 150px;\\n    height: 150px;\\n  }\\n  \\n  @media (max-width: 480px) {\\n    width: 100%;\\n    max-width: 200px;\\n    height: 150px;\\n    margin: 0 auto;\\n  }\\n\"])));const Details=styled.div(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  padding: 10px;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: space-around;\\n  \\n  @media (max-width: 480px) {\\n    padding: 15px 0;\\n    gap: 10px;\\n  }\\n\"])));const ProductName=styled.span(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  font-size: 16px;\\n  font-weight: 500;\\n  \\n  @media (max-width: 480px) {\\n    font-size: 14px;\\n  }\\n\"])));const ProductId=styled.span(_templateObject13||(_templateObject13=_taggedTemplateLiteral([\"\\n  color: gray;\\n  font-size: 12px;\\n\"])));const PriceDetail=styled.div(_templateObject14||(_templateObject14=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  justify-content: center;\\n  gap: 15px;\\n  \\n  @media (max-width: 768px) {\\n    flex-direction: row;\\n    justify-content: space-between;\\n    align-items: center;\\n  }\\n\"])));const ProductAmountContainer=styled.div(_templateObject15||(_templateObject15=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: 10px;\\n\"])));const ProductAmount=styled.div(_templateObject16||(_templateObject16=_taggedTemplateLiteral([\"\\n  font-size: 20px;\\n  margin: 0 10px;\\n  \\n  @media (max-width: 480px) {\\n    font-size: 18px;\\n  }\\n\"])));const ProductPrice=styled.div(_templateObject17||(_templateObject17=_taggedTemplateLiteral([\"\\n  font-size: 24px;\\n  font-weight: 200;\\n  \\n  @media (max-width: 480px) {\\n    font-size: 20px;\\n  }\\n\"])));const Hr=styled.hr(_templateObject18||(_templateObject18=_taggedTemplateLiteral([\"\\n  background-color: #eee;\\n  border: none;\\n  height: 1px;\\n  margin: 20px 0;\\n\"])));const Summary=styled.div(_templateObject19||(_templateObject19=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  border: 0.5px solid lightgray;\\n  border-radius: 10px;\\n  padding: 20px;\\n  height: fit-content;\\n  \\n  @media (max-width: 768px) {\\n    margin-top: 20px;\\n  }\\n  \\n  @media (max-width: 480px) {\\n    padding: 15px;\\n  }\\n\"])));const SummaryTitle=styled.h1(_templateObject20||(_templateObject20=_taggedTemplateLiteral([\"\\n  font-weight: 200;\\n  font-size: 1.5rem;\\n  \\n  @media (max-width: 480px) {\\n    font-size: 1.25rem;\\n  }\\n\"])));const SummaryItem=styled.div(_templateObject21||(_templateObject21=_taggedTemplateLiteral([\"\\n  margin: 20px 0px;\\n  display: flex;\\n  justify-content: space-between;\\n  font-weight: \",\";\\n  font-size: \",\";\\n  \\n  @media (max-width: 480px) {\\n    margin: 15px 0px;\\n    font-size: \",\";\\n  }\\n\"])),props=>props.type===\"total\"&&\"500\",props=>props.type===\"total\"?\"20px\":\"16px\",props=>props.type===\"total\"?\"18px\":\"14px\");const SummaryItemText=styled.span(_templateObject22||(_templateObject22=_taggedTemplateLiteral([\"\"])));const SummaryItemPrice=styled.span(_templateObject23||(_templateObject23=_taggedTemplateLiteral([\"\"])));const Button=styled.button(_templateObject24||(_templateObject24=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: 15px;\\n  background-color: black;\\n  color: white;\\n  font-weight: 600;\\n  border: none;\\n  cursor: pointer;\\n  margin-top: 10px;\\n  border-radius: 8px;\\n  font-size: 16px;\\n  min-height: 50px;\\n  \\n  &:disabled {\\n    background-color: #ccc;\\n    cursor: not-allowed;\\n  }\\n  \\n  @media (max-width: 480px) {\\n    padding: 12px;\\n    font-size: 14px;\\n    min-height: 44px;\\n  }\\n\"])));const QuantityButton=styled.button(_templateObject25||(_templateObject25=_taggedTemplateLiteral([\"\\n  width: 35px;\\n  height: 35px;\\n  border: 1px solid teal;\\n  background-color: white;\\n  cursor: pointer;\\n  font-size: 16px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  border-radius: 4px;\\n  min-height: 35px;\\n  \\n  @media (max-width: 480px) {\\n    width: 30px;\\n    height: 30px;\\n    font-size: 14px;\\n  }\\n\"])));const EmptyCart=styled.div(_templateObject26||(_templateObject26=_taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding: 50px;\\n  font-size: 18px;\\n  color: gray;\\n  \\n  @media (max-width: 480px) {\\n    padding: 30px 20px;\\n    font-size: 16px;\\n  }\\n\"])));const FreeShippingBadge=styled.span(_templateObject27||(_templateObject27=_taggedTemplateLiteral([\"\\n  color: green;\\n  margin-left: 5px;\\n  font-size: 12px;\\n  font-weight: 600;\\n\"])));const AddressSection=styled.div(_templateObject28||(_templateObject28=_taggedTemplateLiteral([\"\\n  margin: 20px 0;\\n  padding: 20px;\\n  border: 1px solid #eee;\\n  border-radius: 10px;\\n  background-color: #f9f9f9;\\n  \\n  @media (max-width: 480px) {\\n    padding: 15px;\\n  }\\n\"])));const AddressSelector=styled.div(_templateObject29||(_templateObject29=_taggedTemplateLiteral([\"\\n  margin-bottom: 15px;\\n\"])));const AddressOption=styled.div(_templateObject30||(_templateObject30=_taggedTemplateLiteral([\"\\n  padding: 12px;\\n  border: 2px solid \",\";\\n  border-radius: 8px;\\n  margin-bottom: 10px;\\n  cursor: pointer;\\n  background: white;\\n  transition: all 0.3s ease;\\n\\n  &:hover {\\n    border-color: #667eea;\\n  }\\n\"])),props=>props.selected?'#667eea':'#e2e8f0');const AddressText=styled.p(_templateObject31||(_templateObject31=_taggedTemplateLiteral([\"\\n  margin: 5px 0;\\n  color: #2d3748;\\n  line-height: 1.4;\\n\"])));const AddressType=styled.span(_templateObject32||(_templateObject32=_taggedTemplateLiteral([\"\\n  background: \",\";\\n  color: \",\";\\n  padding: 4px 8px;\\n  border-radius: 4px;\\n  font-size: 0.8rem;\\n  font-weight: 600;\\n  margin-right: 10px;\\n\"])),props=>props.isDefault?'#667eea':'#e2e8f0',props=>props.isDefault?'white':'#4a5568');const NewAddressButton=styled.button(_templateObject33||(_templateObject33=_taggedTemplateLiteral([\"\\n  background: #e2e8f0;\\n  color: #4a5568;\\n  border: none;\\n  padding: 10px 15px;\\n  border-radius: 6px;\\n  cursor: pointer;\\n  font-size: 14px;\\n  font-weight: 600;\\n  margin-top: 10px;\\n\\n  &:hover {\\n    background: #cbd5e0;\\n  }\\n\"])));const Input=styled.input(_templateObject34||(_templateObject34=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: 12px;\\n  margin: 8px 0;\\n  border: 1px solid #ddd;\\n  border-radius: 4px;\\n  font-size: 14px;\\n  \\n  @media (max-width: 480px) {\\n    padding: 10px;\\n    font-size: 16px;\\n  }\\n\"])));const InputRow=styled.div(_templateObject35||(_templateObject35=_taggedTemplateLiteral([\"\\n  display: flex;\\n  gap: 10px;\\n  \\n  @media (max-width: 768px) {\\n    flex-direction: column;\\n  }\\n\"])));const InputGroup=styled.div(_templateObject36||(_templateObject36=_taggedTemplateLiteral([\"\\n  flex: 1;\\n\"])));const PaymentModal=styled.div(_templateObject37||(_templateObject37=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n  background: rgba(0, 0, 0, 0.5);\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  z-index: 1000;\\n  padding: 20px;\\n  \\n  @media (max-width: 480px) {\\n    padding: 10px;\\n    align-items: flex-start;\\n    padding-top: 50px;\\n  }\\n\"])));const PaymentContent=styled.div(_templateObject38||(_templateObject38=_taggedTemplateLiteral([\"\\n  background: white;\\n  padding: 2rem;\\n  border-radius: 12px;\\n  width: 90%;\\n  max-width: 500px;\\n  text-align: center;\\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\\n  max-height: 90vh;\\n  overflow-y: auto;\\n  \\n  @media (max-width: 480px) {\\n    padding: 1.5rem;\\n    max-height: 80vh;\\n  }\\n\"])));const PayNowBtn=styled.button(_templateObject39||(_templateObject39=_taggedTemplateLiteral([\"\\n  background: #4CAF50;\\n  color: white;\\n  padding: 12px 24px;\\n  border: none;\\n  border-radius: 6px;\\n  cursor: pointer;\\n  margin: 5px;\\n  font-size: 16px;\\n  font-weight: 600;\\n  width: 100%;\\n  transition: background 0.3s;\\n\\n  &:hover {\\n    background: #45a049;\\n  }\\n\\n  &:disabled {\\n    background: #cccccc;\\n    cursor: not-allowed;\\n  }\\n\"])));const CancelBtn=styled.button(_templateObject40||(_templateObject40=_taggedTemplateLiteral([\"\\n  background: #f44336;\\n  color: white;\\n  padding: 12px 24px;\\n  border: none;\\n  border-radius: 6px;\\n  cursor: pointer;\\n  margin: 5px;\\n  font-size: 16px;\\n  font-weight: 600;\\n  width: 100%;\\n  transition: background 0.3s;\\n\\n  &:hover {\\n    background: #da190b;\\n  }\\n\"])));const ErrorMessage=styled.div(_templateObject41||(_templateObject41=_taggedTemplateLiteral([\"\\n  color: #d32f2f;\\n  background-color: #ffebee;\\n  padding: 12px;\\n  border-radius: 6px;\\n  margin: 15px 0;\\n  font-size: 14px;\\n  border: 1px solid #f5c6cb;\\n\"])));const SuccessMessage=styled.div(_templateObject42||(_templateObject42=_taggedTemplateLiteral([\"\\n  color: #155724;\\n  background-color: #d4edda;\\n  padding: 12px;\\n  border-radius: 6px;\\n  margin: 15px 0;\\n  font-size: 14px;\\n  border: 1px solid #c3e6cb;\\n\"])));const CardFormContainer=styled.div(_templateObject43||(_templateObject43=_taggedTemplateLiteral([\"\\n  margin: 20px 0;\\n  text-align: left;\\n\"])));const CardFieldContainer=styled.div(_templateObject44||(_templateObject44=_taggedTemplateLiteral([\"\\n  margin-bottom: 15px;\\n\"])));const CardFieldLabel=styled.label(_templateObject45||(_templateObject45=_taggedTemplateLiteral([\"\\n  display: block;\\n  margin-bottom: 5px;\\n  font-weight: 600;\\n  color: #333;\\n  font-size: 14px;\\n\"])));const CardFieldWrapper=styled.div(_templateObject46||(_templateObject46=_taggedTemplateLiteral([\"\\n  padding: 12px;\\n  border: 2px solid #e1e5e9;\\n  border-radius: 8px;\\n  background: white;\\n  transition: border-color 0.3s;\\n  \\n  &:focus-within {\\n    border-color: #4CAF50;\\n    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);\\n  }\\n\"])));const CardRow=styled.div(_templateObject47||(_templateObject47=_taggedTemplateLiteral([\"\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 15px;\\n  \\n  @media (max-width: 480px) {\\n    grid-template-columns: 1fr;\\n  }\\n\"])));const LoadingSpinner=styled.div(_templateObject48||(_templateObject48=_taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding: 20px;\\n  color: #666;\\n\"])));// ========== STRIPE PAYMENT FORM COMPONENT ==========\nconst StripePaymentForm=_ref=>{let{amount,clientSecret,onSuccess,onError}=_ref;}// ... (keep your existing StripePaymentForm component exactly as it is)\n;// ========== MAIN CART PAGE COMPONENT ==========\nconst CartPage=()=>{const[cartItems,setCartItems]=useState([]);const[loading,setLoading]=useState(false);const[isCheckingOut,setIsCheckingOut]=useState(false);const[showAddressSection,setShowAddressSection]=useState(false);const[showPayment,setShowPayment]=useState(false);const[paymentError,setPaymentError]=useState('');const[paymentSuccess,setPaymentSuccess]=useState('');const[clientSecret,setClientSecret]=useState('');const[currentOrderId,setCurrentOrderId]=useState('');const[userAddresses,setUserAddresses]=useState([]);const[selectedAddress,setSelectedAddress]=useState(null);const[showNewAddressForm,setShowNewAddressForm]=useState(false);const navigate=useNavigate();const[newAddress,setNewAddress]=useState({street:\"\",city:\"\",state:\"\",zipCode:\"\",country:\"United States\",type:\"home\",isDefault:false});// Helper Functions\nconst getAuthHeader=()=>{const token=localStorage.getItem('token');return token?{Authorization:\"Bearer \".concat(token)}:{};};const getCurrentUser=()=>{const token=localStorage.getItem('token');if(token){try{const base64Payload=token.split('.')[1];const payload=JSON.parse(atob(base64Payload));return payload.userId;}catch(error){return null;}}return null;};const calculateShipping=()=>{const subtotal=getTotal();if(subtotal>=50){return{shipping:0,hasFreeShipping:true};}else{return{shipping:5.90,hasFreeShipping:false};}};const getTotal=()=>{return cartItems.reduce((total,item)=>total+parseFloat(item.price)*item.quantity,0);};const getFinalTotal=()=>{const shippingInfo=calculateShipping();return getTotal()+shippingInfo.shipping;};// UPDATED: Reliable cart clearing function\nconst clearCartReliably=async userId=>{const token=localStorage.getItem('token');const BASE_URL=process.env.REACT_APP_API_URL;console.log('🔄 Starting reliable cart clearing process...');// Strategy 1: Try backend API first\ntry{console.log('🔄 Attempting backend cart clearing...');const response=await axios.delete(\"\".concat(BASE_URL,\"/api/cart/\").concat(userId,\"/clear\"),{headers:{Authorization:\"Bearer \".concat(token)},timeout:5000});if(response.data.message==='Cart cleared successfully'){console.log('✅ Backend cart cleared successfully');return true;}}catch(backendError){console.warn('⚠️ Backend cart clearing failed, trying individual item removal:',backendError.message);// Strategy 2: Remove items one by one\ntry{for(const item of cartItems){await axios.delete(\"\".concat(BASE_URL,\"/api/cart/\").concat(userId,\"/\").concat(item.productId),{headers:{Authorization:\"Bearer \".concat(token)},timeout:3000});console.log(\"\\u2705 Removed item \".concat(item.productId,\" from cart\"));}console.log('✅ All items removed individually');return true;}catch(individualError){console.warn('⚠️ Individual item removal failed:',individualError.message);// Strategy 3: Update quantities to 0\ntry{for(const item of cartItems){await axios.put(\"\".concat(BASE_URL,\"/api/cart/\").concat(userId),{productId:item.productId,quantity:0},{headers:{Authorization:\"Bearer \".concat(token)},timeout:3000});}console.log('✅ All quantities set to 0');return true;}catch(quantityError){console.error('❌ All cart clearing strategies failed:',quantityError.message);return false;}}}return false;};// Fetch user addresses from profile\nconst fetchUserAddresses=async()=>{try{const token=localStorage.getItem('token');const response=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/auth/addresses\"),{headers:{Authorization:\"Bearer \".concat(token)}});const addresses=response.data.addresses||[];setUserAddresses(addresses);// Auto-select default address\nconst defaultAddress=addresses.find(addr=>addr.isDefault);if(defaultAddress){setSelectedAddress(defaultAddress);}else if(addresses.length>0){setSelectedAddress(addresses[0]);}}catch(error){console.error('Error fetching addresses:',error);}};// Add new address to profile\nconst addNewAddress=async()=>{try{const token=localStorage.getItem('token');const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/auth/addresses\"),newAddress,{headers:{Authorization:\"Bearer \".concat(token)}});// Refresh addresses\nawait fetchUserAddresses();setShowNewAddressForm(false);setNewAddress({street:\"\",city:\"\",state:\"\",zipCode:\"\",country:\"United States\",type:\"home\",isDefault:false});}catch(error){console.error('Error adding address:',error);alert('Failed to add address');}};// Function to send payment confirmation email\nconst sendPaymentConfirmationEmail=async(orderData,paymentData)=>{try{console.log('📧 Sending payment confirmation email for order:',orderData.id);const user=JSON.parse(localStorage.getItem('user'));const userEmail=user===null||user===void 0?void 0:user.email;if(!userEmail){console.warn('No email found for payment confirmation');return false;}const emailData={paymentData:{id:paymentData.id,orderId:orderData.id,amount:orderData.amount,paymentMethod:'Credit Card',status:'completed',paymentDate:new Date().toISOString(),receiptUrl:\"https://quickcart.com/receipts/\".concat(paymentData.id),products:orderData.products,shipping:orderData.shipping||0,tax:orderData.tax||0},userEmail:userEmail};const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/email/payment-confirmation\"),emailData,{headers:getAuthHeader()});console.log('✅ Payment confirmation email sent successfully:',response.data);return true;}catch(emailError){console.error('❌ Failed to send payment confirmation email:',emailError);return false;}};// Function to send order confirmation email\nconst sendOrderConfirmationEmail=async orderData=>{try{console.log('📧 Sending order confirmation email for order:',orderData.id);const user=JSON.parse(localStorage.getItem('user'));const userEmail=user===null||user===void 0?void 0:user.email;if(!userEmail){console.warn('No email found for order confirmation');return false;}const emailData={orderData:orderData,userEmail:userEmail};const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/email/order-confirmation\"),emailData,{headers:getAuthHeader()});console.log('✅ Order confirmation email sent successfully:',response.data);return true;}catch(emailError){console.error('❌ Failed to send order confirmation email:',emailError);return false;}};// Clear payment flag function\nconst clearPaymentFlag=()=>{localStorage.removeItem('paymentCompleted');console.log('🗑️ Payment flag cleared');};const fetchCart=useCallback(async()=>{const userId=getCurrentUser();if(!userId){setCartItems([]);return;}try{setLoading(true);console.log('🔄 Fetching cart...');const response=await axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/api/cart/\").concat(userId),{headers:getAuthHeader()});console.log('✅ Cart data received:',response.data.length,'items');setCartItems(response.data);}catch(error){console.error('Error fetching cart:',error);}finally{setLoading(false);}},[]);const updateCartItem=async(productId,quantity)=>{const userId=getCurrentUser();if(!userId)return;try{await axios.put(\"\".concat(process.env.REACT_APP_API_URL,\"/api/cart/\").concat(userId),{productId,quantity},{headers:getAuthHeader()});await fetchCart();}catch(error){console.error('Error updating cart:',error);}};const removeFromCart=async productId=>{const userId=getCurrentUser();if(!userId)return;try{await axios.delete(\"\".concat(process.env.REACT_APP_API_URL,\"/api/cart/\").concat(userId,\"/\").concat(productId),{headers:getAuthHeader()});await fetchCart();}catch(error){console.error('Error removing from cart:',error);}};// Clear payment flag on component mount and setup debug logging\nuseEffect(()=>{console.log('🔍 CartPage mounted, clearing payment flag');clearPaymentFlag();fetchCart();fetchUserAddresses();},[fetchCart]);// Debug cart updates\nuseEffect(()=>{console.log('📦 Cart items updated:',{itemCount:cartItems.length,items:cartItems,paymentFlag:localStorage.getItem('paymentCompleted')});},[cartItems]);const handleQuantity=(productId,quantity)=>{if(quantity===0){removeFromCart(productId);}else{updateCartItem(productId,quantity);}};const handlePayment=async()=>{setPaymentError('');setPaymentSuccess('');setIsCheckingOut(true);try{const userId=getCurrentUser();const token=localStorage.getItem('token');const BASE_URL=process.env.REACT_APP_API_URL;// Validate address first\nif(!selectedAddress){throw new Error('Please select a shipping address');}// Validate cart items\nif(cartItems.length===0){throw new Error('Cart is empty');}console.log('🔄 Starting payment process...');console.log('📦 Cart items:',cartItems);console.log('🏠 Selected address:',selectedAddress);console.log('💰 Total amount:',getFinalTotal());// Step 1: Create order FIRST with proper data structure\nconst orderData={cartItems:cartItems.map(item=>({productId:item.productId||item.id,title:item.title||item.name,price:parseFloat(item.price),quantity:item.quantity,size:item.size||'One Size',color:item.color||'Default',img:item.img||item.image})),address:selectedAddress,totalAmount:getFinalTotal()};console.log('📦 Creating order with data:',orderData);const orderResponse=await axios.post(\"\".concat(BASE_URL,\"/api/orders\"),orderData,{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'},timeout:10000});console.log('✅ Order creation response:',orderResponse.data);if(!orderResponse.data.order||!orderResponse.data.order.id){throw new Error('Order creation failed - no order ID returned');}const createdOrderId=orderResponse.data.order.id;setCurrentOrderId(createdOrderId);console.log('✅ Order created successfully:',createdOrderId);// Step 2: Create payment intent with the order ID\nconst amount=Math.round(getFinalTotal()*100);console.log('💳 Creating payment intent for amount:',amount);const paymentResponse=await axios.post(\"\".concat(BASE_URL,\"/api/payments/create-payment-intent\"),{orderId:createdOrderId,amount:amount,currency:'usd'},{headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'},timeout:10000});console.log('✅ Payment intent response:',paymentResponse.data);if(paymentResponse.data.clientSecret){console.log('✅ Payment intent created, client secret received');setClientSecret(paymentResponse.data.clientSecret);}else{throw new Error('No client secret received from payment service');}}catch(error){var _error$response,_error$response$data,_error$response2,_error$response2$data;console.error('❌ Payment setup error:',error);const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||error.message;setPaymentError(\"Payment setup failed: \".concat(errorMessage));setIsCheckingOut(false);}};// UPDATED: Reliable payment success handler\nconst handlePaymentSuccess=async paymentIntent=>{try{var _JSON$parse;const userId=getCurrentUser();const token=localStorage.getItem('token');const BASE_URL=process.env.REACT_APP_API_URL;const userEmail=(_JSON$parse=JSON.parse(localStorage.getItem('user')))===null||_JSON$parse===void 0?void 0:_JSON$parse.email;console.log('✅ Payment successful, paymentIntent:',paymentIntent);// STEP 1: CLEAR CART RELIABLY (MOST IMPORTANT)\nconsole.log('🛒 Starting reliable cart clearing...');const cartCleared=await clearCartReliably(userId);// STEP 2: Clear cart locally regardless of backend success\nsetCartItems([]);console.log('✅ Cart cleared locally');if(!cartCleared){console.warn('⚠️ Backend cart clearing had issues, but continuing with payment success');}// STEP 3: Try to confirm payment with backend (optional)\nlet paymentConfirmed=false;try{const paymentConfirmation=await axios.post(\"\".concat(BASE_URL,\"/api/payments/confirm-payment\"),{paymentIntentId:paymentIntent.id,orderId:currentOrderId},{headers:{Authorization:\"Bearer \".concat(token)},timeout:10000});console.log('✅ Payment confirmed by backend:',paymentConfirmation.data);paymentConfirmed=true;}catch(confirmError){console.warn('⚠️ Payment confirmation API failed, but continuing:',confirmError.message);}// STEP 4: Verify order exists in database\nlet orderVerified=false;try{const orderVerification=await axios.get(\"\".concat(BASE_URL,\"/api/orders/\").concat(currentOrderId),{headers:{Authorization:\"Bearer \".concat(token)},timeout:5000});if(orderVerification.data.order){orderVerified=true;console.log('✅ Order verified in database:',orderVerification.data.order);}}catch(orderError){console.error('❌ Order verification failed:',orderError);}// STEP 5: Update order payment status if order exists\nif(orderVerified){try{const orderUpdateResponse=await axios.put(\"\".concat(BASE_URL,\"/api/orders/\").concat(currentOrderId,\"/payment-status\"),{paymentStatus:'paid'},{headers:{Authorization:\"Bearer \".concat(token)},timeout:5000});console.log('✅ Order payment status updated:',orderUpdateResponse.data);}catch(orderError){console.error('⚠️ Order status update failed:',orderError);}}// STEP 6: Prepare success data\nconst orderDataForSuccess={id:currentOrderId,amount:getFinalTotal().toFixed(2),products:cartItems.map(item=>({title:item.title||item.name,price:item.price,quantity:item.quantity,img:item.img||item.image,size:item.size,color:item.color})),address:selectedAddress,paymentMethod:'Credit Card',status:'confirmed',paymentStatus:'paid',createdAt:new Date().toISOString(),paymentIntentId:paymentIntent.id,shipping:calculateShipping().shipping,tax:0};localStorage.setItem('lastOrder',JSON.stringify(orderDataForSuccess));if(userEmail){localStorage.setItem('userEmail',userEmail);}// STEP 7: SEND EMAILS (non-blocking)\nconsole.log('📧 Sending emails...');Promise.all([sendPaymentConfirmationEmail(orderDataForSuccess,paymentIntent),sendOrderConfirmationEmail(orderDataForSuccess)]).then(_ref2=>{let[paymentEmailSent,orderEmailSent]=_ref2;console.log('📧 Email status:',{paymentEmail:paymentEmailSent?'✅ Sent':'❌ Failed',orderEmail:orderEmailSent?'✅ Sent':'❌ Failed'});}).catch(emailError=>{console.error('📧 Email sending error:',emailError);});console.log('🎉 Payment completed successfully, redirecting...');// STEP 8: Set flag to prevent cart refetching\nlocalStorage.setItem('paymentCompleted','true');localStorage.setItem('lastCartClearTime',Date.now().toString());// STEP 9: Show success message and redirect\nsetPaymentSuccess('Payment successful! Cart cleared. Redirecting...');setTimeout(()=>{setShowPayment(false);setClientSecret('');navigate('/success');},1500);}catch(error){var _error$response3,_error$response3$data;console.error('❌ Post-payment processing error:',error);const errorMessage=((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||error.message;// Even if there are issues, if payment was successful with Stripe, proceed\nif(paymentIntent.status==='succeeded'){console.log('⚠️ Minor issues but Stripe payment succeeded, proceeding...');// Clear cart locally anyway as fallback\nsetCartItems([]);localStorage.setItem('paymentCompleted','true');localStorage.setItem('lastCartClearTime',Date.now().toString());setPaymentSuccess('Payment successful! Minor processing issues. Redirecting...');setTimeout(()=>{setShowPayment(false);setClientSecret('');navigate('/success');},1500);}else{setPaymentError(\"Payment processing failed: \".concat(errorMessage));}}};const handlePaymentError=errorMessage=>{console.error('❌ Payment error:',errorMessage);setPaymentError(\"Payment failed: \".concat(errorMessage));};const handleCheckout=()=>{if(cartItems.length===0){alert('Your cart is empty');return;}const token=localStorage.getItem('token');if(!token){alert('Please login to checkout');navigate('/login');return;}if(!showAddressSection){setShowAddressSection(true);return;}// Validate address before proceeding to payment\nif(!selectedAddress){alert('Please select a shipping address');return;}setShowPayment(true);handlePayment();// Start the payment process\n};const handleInputChange=e=>{const{name,value}=e.target;setNewAddress(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleContinueShopping=()=>{// Clear payment flag when user continues shopping\nclearPaymentFlag();navigate('/');};const handleManageAddresses=()=>{navigate('/addresses');};const shippingInfo=calculateShipping();if(loading){return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Wrapper,{children:[/*#__PURE__*/_jsx(Title,{children:\"YOUR BAG\"}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'50px'},children:\"Loading cart...\"})]})});}return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsxs(Wrapper,{children:[/*#__PURE__*/_jsx(Title,{children:\"YOUR BAG\"}),/*#__PURE__*/_jsxs(Top,{children:[/*#__PURE__*/_jsx(TopButton,{onClick:handleContinueShopping,children:\"CONTINUE SHOPPING\"}),/*#__PURE__*/_jsxs(TopTexts,{children:[/*#__PURE__*/_jsxs(TopText,{children:[\"Shopping Bag(\",cartItems.length,\")\"]}),/*#__PURE__*/_jsx(TopText,{children:\"Your Wishlist (0)\"})]}),/*#__PURE__*/_jsx(TopButton,{type:\"filled\",onClick:handleCheckout,disabled:cartItems.length===0,children:isCheckingOut?'PROCESSING...':'CHECKOUT NOW'})]}),/*#__PURE__*/_jsxs(Bottom,{children:[/*#__PURE__*/_jsx(Info,{children:cartItems.length===0?/*#__PURE__*/_jsxs(EmptyCart,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Your cart is empty\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Add some products to your cart to see them here\"}),/*#__PURE__*/_jsx(TopButton,{onClick:handleContinueShopping,style:{marginTop:'20px'},children:\"START SHOPPING\"})]}):cartItems.map(item=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Product,{children:[/*#__PURE__*/_jsxs(ProductDetail,{children:[/*#__PURE__*/_jsx(Image,{src:item.img||'https://via.placeholder.com/200x200?text=No+Image'}),/*#__PURE__*/_jsxs(Details,{children:[/*#__PURE__*/_jsxs(ProductName,{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Product:\"}),\" \",item.title]}),/*#__PURE__*/_jsxs(ProductId,{children:[/*#__PURE__*/_jsx(\"b\",{children:\"ID:\"}),\" \",item.productId]}),item.size&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Size:\"}),\" \",item.size]}),item.color&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Color:\"}),\" \",item.color]})]})]}),/*#__PURE__*/_jsxs(PriceDetail,{children:[/*#__PURE__*/_jsxs(ProductAmountContainer,{children:[/*#__PURE__*/_jsx(QuantityButton,{onClick:()=>handleQuantity(item.productId,item.quantity-1),children:\"-\"}),/*#__PURE__*/_jsx(ProductAmount,{children:item.quantity}),/*#__PURE__*/_jsx(QuantityButton,{onClick:()=>handleQuantity(item.productId,item.quantity+1),children:\"+\"})]}),/*#__PURE__*/_jsxs(ProductPrice,{children:[\"$ \",(parseFloat(item.price)*item.quantity).toFixed(2)]})]})]}),/*#__PURE__*/_jsx(Hr,{})]},item.id))}),cartItems.length>0&&/*#__PURE__*/_jsxs(Summary,{children:[/*#__PURE__*/_jsx(SummaryTitle,{children:\"ORDER SUMMARY\"}),/*#__PURE__*/_jsxs(SummaryItem,{children:[/*#__PURE__*/_jsx(SummaryItemText,{children:\"Subtotal\"}),/*#__PURE__*/_jsxs(SummaryItemPrice,{children:[\"$ \",getTotal().toFixed(2)]})]}),/*#__PURE__*/_jsxs(SummaryItem,{children:[/*#__PURE__*/_jsxs(SummaryItemText,{children:[\"Shipping\",shippingInfo.hasFreeShipping&&/*#__PURE__*/_jsx(FreeShippingBadge,{children:\"\\uD83D\\uDE9A FREE\"})]}),/*#__PURE__*/_jsx(SummaryItemPrice,{children:shippingInfo.hasFreeShipping?'$ 0.00':\"$ \".concat(shippingInfo.shipping.toFixed(2))})]}),!shippingInfo.hasFreeShipping&&/*#__PURE__*/_jsxs(SummaryItem,{children:[/*#__PURE__*/_jsxs(SummaryItemText,{style:{fontSize:'12px',color:'#666',fontStyle:'italic'},children:[\"Add $\",(50-getTotal()).toFixed(2),\" more for free shipping!\"]}),/*#__PURE__*/_jsx(SummaryItemPrice,{})]}),/*#__PURE__*/_jsxs(SummaryItem,{type:\"total\",children:[/*#__PURE__*/_jsx(SummaryItemText,{children:\"Total\"}),/*#__PURE__*/_jsxs(SummaryItemPrice,{children:[\"$ \",getFinalTotal().toFixed(2)]})]}),showAddressSection&&/*#__PURE__*/_jsxs(AddressSection,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Shipping Address\"}),userAddresses.length>0?/*#__PURE__*/_jsxs(AddressSelector,{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Select a saved address:\"}),userAddresses.map(address=>/*#__PURE__*/_jsxs(AddressOption,{selected:(selectedAddress===null||selectedAddress===void 0?void 0:selectedAddress.id)===address.id,onClick:()=>setSelectedAddress(address),children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(AddressType,{isDefault:address.isDefault,children:[address.type,\" \",address.isDefault&&'(Default)']})}),/*#__PURE__*/_jsx(AddressText,{children:address.street}),/*#__PURE__*/_jsxs(AddressText,{children:[address.city,\", \",address.state,\" \",address.zipCode]}),/*#__PURE__*/_jsx(AddressText,{children:address.country})]},address.id))]}):/*#__PURE__*/_jsx(\"p\",{children:\"No saved addresses found.\"}),!showNewAddressForm?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(NewAddressButton,{onClick:()=>setShowNewAddressForm(true),children:\"+ Add New Address\"}),/*#__PURE__*/_jsx(NewAddressButton,{onClick:handleManageAddresses,style:{marginLeft:'10px'},children:\"\\uD83D\\uDCCB Manage Addresses\"})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Add New Address\"}),/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"street\",placeholder:\"Street Address\",value:newAddress.street,onChange:handleInputChange,required:true}),/*#__PURE__*/_jsxs(InputRow,{children:[/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"city\",placeholder:\"City\",value:newAddress.city,onChange:handleInputChange,required:true})}),/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"state\",placeholder:\"State\",value:newAddress.state,onChange:handleInputChange,required:true})})]}),/*#__PURE__*/_jsxs(InputRow,{children:[/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"zipCode\",placeholder:\"ZIP Code\",value:newAddress.zipCode,onChange:handleInputChange,required:true})}),/*#__PURE__*/_jsx(InputGroup,{children:/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"country\",placeholder:\"Country\",value:newAddress.country,onChange:handleInputChange,required:true})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px',marginTop:'10px'},children:[/*#__PURE__*/_jsx(NewAddressButton,{onClick:addNewAddress,children:\"Save Address\"}),/*#__PURE__*/_jsx(NewAddressButton,{onClick:()=>setShowNewAddressForm(false),children:\"Cancel\"})]})]})]}),/*#__PURE__*/_jsx(Button,{onClick:handleCheckout,disabled:cartItems.length===0||isCheckingOut||showAddressSection&&!selectedAddress,style:{backgroundColor:cartItems.length===0?'#ccc':isCheckingOut?'#ffa500':'#000'},children:isCheckingOut?'🔄 PROCESSING...':showAddressSection?'💳 PROCEED TO PAYMENT':\"\\uD83D\\uDED2 CHECKOUT NOW ($\".concat(getFinalTotal().toFixed(2),\")\")})]})]})]}),showPayment&&/*#__PURE__*/_jsx(PaymentModal,{children:/*#__PURE__*/_jsxs(PaymentContent,{children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginBottom:'10px',color:'#333'},children:\"Complete Your Purchase\"}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'18px',fontWeight:'600',color:'#2c5aa0',marginBottom:'20px'},children:[\"Total Amount: \",/*#__PURE__*/_jsxs(\"span\",{style:{color:'#4CAF50'},children:[\"$\",getFinalTotal().toFixed(2)]})]}),paymentError&&/*#__PURE__*/_jsxs(ErrorMessage,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Payment Error:\"}),\" \",paymentError,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"Please check your address information and try again.\"})]}),paymentSuccess&&/*#__PURE__*/_jsx(SuccessMessage,{children:paymentSuccess}),!clientSecret&&isCheckingOut&&/*#__PURE__*/_jsxs(LoadingSpinner,{children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'10px'},children:\"\\uD83D\\uDD04 Setting up payment...\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'14px',color:'#666'},children:\"Creating order and payment session...\"})]}),clientSecret?/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,options:{clientSecret},children:/*#__PURE__*/_jsx(StripePaymentForm,{amount:getFinalTotal().toFixed(2),clientSecret:clientSecret,onSuccess:handlePaymentSuccess,onError:handlePaymentError})}):!isCheckingOut&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(PayNowBtn,{onClick:handlePayment,disabled:isCheckingOut,children:isCheckingOut?'Setting Up Payment...':'Try Payment Again'})}),/*#__PURE__*/_jsx(CancelBtn,{onClick:()=>{setShowPayment(false);setClientSecret('');setPaymentError('');setPaymentSuccess('');setIsCheckingOut(false);},children:\"Cancel Payment\"})]})})]});};export default CartPage;","map":{"version":3,"names":["React","useState","useEffect","useCallback","styled","axios","useNavigate","loadStripe","Elements","CardNumberElement","CardExpiryElement","CardCvcElement","useStripe","useElements","jsx","_jsx","jsxs","_jsxs","stripePromise","Container","div","_templateObject","_taggedTemplateLiteral","Wrapper","_templateObject2","Title","h1","_templateObject3","Top","_templateObject4","TopButton","button","_templateObject5","props","type","TopTexts","_templateObject6","TopText","span","_templateObject7","Bottom","_templateObject8","Info","_templateObject9","Product","_templateObject0","ProductDetail","_templateObject1","Image","img","_templateObject10","Details","_templateObject11","ProductName","_templateObject12","ProductId","_templateObject13","PriceDetail","_templateObject14","ProductAmountContainer","_templateObject15","ProductAmount","_templateObject16","ProductPrice","_templateObject17","Hr","hr","_templateObject18","Summary","_templateObject19","SummaryTitle","_templateObject20","SummaryItem","_templateObject21","SummaryItemText","_templateObject22","SummaryItemPrice","_templateObject23","Button","_templateObject24","QuantityButton","_templateObject25","EmptyCart","_templateObject26","FreeShippingBadge","_templateObject27","AddressSection","_templateObject28","AddressSelector","_templateObject29","AddressOption","_templateObject30","selected","AddressText","p","_templateObject31","AddressType","_templateObject32","isDefault","NewAddressButton","_templateObject33","Input","input","_templateObject34","InputRow","_templateObject35","InputGroup","_templateObject36","PaymentModal","_templateObject37","PaymentContent","_templateObject38","PayNowBtn","_templateObject39","CancelBtn","_templateObject40","ErrorMessage","_templateObject41","SuccessMessage","_templateObject42","CardFormContainer","_templateObject43","CardFieldContainer","_templateObject44","CardFieldLabel","label","_templateObject45","CardFieldWrapper","_templateObject46","CardRow","_templateObject47","LoadingSpinner","_templateObject48","StripePaymentForm","_ref","amount","clientSecret","onSuccess","onError","CartPage","cartItems","setCartItems","loading","setLoading","isCheckingOut","setIsCheckingOut","showAddressSection","setShowAddressSection","showPayment","setShowPayment","paymentError","setPaymentError","paymentSuccess","setPaymentSuccess","setClientSecret","currentOrderId","setCurrentOrderId","userAddresses","setUserAddresses","selectedAddress","setSelectedAddress","showNewAddressForm","setShowNewAddressForm","navigate","newAddress","setNewAddress","street","city","state","zipCode","country","getAuthHeader","token","localStorage","getItem","Authorization","concat","getCurrentUser","base64Payload","split","payload","JSON","parse","atob","userId","error","calculateShipping","subtotal","getTotal","shipping","hasFreeShipping","reduce","total","item","parseFloat","price","quantity","getFinalTotal","shippingInfo","clearCartReliably","BASE_URL","process","env","REACT_APP_API_URL","console","log","response","delete","headers","timeout","data","message","backendError","warn","productId","individualError","put","quantityError","fetchUserAddresses","get","addresses","defaultAddress","find","addr","length","addNewAddress","post","alert","sendPaymentConfirmationEmail","orderData","paymentData","id","user","userEmail","email","emailData","orderId","paymentMethod","status","paymentDate","Date","toISOString","receiptUrl","products","tax","emailError","sendOrderConfirmationEmail","clearPaymentFlag","removeItem","fetchCart","updateCartItem","removeFromCart","itemCount","items","paymentFlag","handleQuantity","handlePayment","Error","map","title","name","size","color","image","address","totalAmount","orderResponse","order","createdOrderId","Math","round","paymentResponse","currency","_error$response","_error$response$data","_error$response2","_error$response2$data","errorMessage","handlePaymentSuccess","paymentIntent","_JSON$parse","cartCleared","paymentConfirmed","paymentConfirmation","paymentIntentId","confirmError","orderVerified","orderVerification","orderError","orderUpdateResponse","paymentStatus","orderDataForSuccess","toFixed","createdAt","setItem","stringify","Promise","all","then","_ref2","paymentEmailSent","orderEmailSent","paymentEmail","orderEmail","catch","now","toString","setTimeout","_error$response3","_error$response3$data","handlePaymentError","handleCheckout","handleInputChange","e","value","target","prev","_objectSpread","handleContinueShopping","handleManageAddresses","children","style","textAlign","padding","onClick","disabled","marginTop","src","fontSize","fontStyle","marginLeft","placeholder","onChange","required","display","gap","backgroundColor","marginBottom","fontWeight","stripe","options"],"sources":["D:/raju new 1/front-end/src/pages/CartPage.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport axios from \"axios\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\nimport { \r\n  Elements, \r\n  CardNumberElement, \r\n  CardExpiryElement, \r\n  CardCvcElement, \r\n  useStripe, \r\n  useElements \r\n} from \"@stripe/react-stripe-js\";\r\n\r\nconst stripePromise = loadStripe(\"pk_test_51SEWfbGUJ7v3D9GXVs5sPIBEY08wZrpGmeuko8YClRovgbeQkkYJ2NpxLMtM3RyA8v7NSKM4cE8mTLthWafiYGv500lPgVJb3n\");\r\n\r\n// ========== ALL STYLED COMPONENTS ==========\r\nconst Container = styled.div``;\r\n\r\nconst Wrapper = styled.div`\r\n  padding: 20px;\r\n  \r\n  @media (max-width: 768px) {\r\n    padding: 10px;\r\n  }\r\n`;\r\n\r\nconst Title = styled.h1`\r\n  font-weight: 300;\r\n  text-align: center;\r\n  font-size: 1.5rem;\r\n  \r\n  @media (min-width: 768px) {\r\n    font-size: 2rem;\r\n  }\r\n`;\r\n\r\nconst Top = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 20px;\r\n  flex-wrap: wrap;\r\n  gap: 15px;\r\n  \r\n  @media (max-width: 768px) {\r\n    padding: 15px 10px;\r\n    justify-content: center;\r\n  }\r\n`;\r\n\r\nconst TopButton = styled.button`\r\n  padding: 12px 20px;\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n  border: ${(props) => props.type === \"filled\" && \"none\"};\r\n  background-color: ${(props) =>\r\n    props.type === \"filled\" ? \"black\" : \"transparent\"};\r\n  color: ${(props) => props.type === \"filled\" && \"white\"};\r\n  border-radius: 8px;\r\n  font-size: 14px;\r\n  min-height: 44px;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 10px 15px;\r\n    font-size: 12px;\r\n    min-height: 40px;\r\n  }\r\n`;\r\n\r\nconst TopTexts = styled.div`\r\n  display: flex;\r\n  gap: 10px;\r\n  \r\n  @media (max-width: 480px) {\r\n    flex-direction: column;\r\n    align-items: center;\r\n    gap: 5px;\r\n  }\r\n`;\r\n\r\nconst TopText = styled.span`\r\n  text-decoration: underline;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  \r\n  @media (max-width: 480px) {\r\n    font-size: 12px;\r\n  }\r\n`;\r\n\r\nconst Bottom = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  gap: 20px;\r\n  \r\n  @media (max-width: 768px) {\r\n    flex-direction: column;\r\n  }\r\n`;\r\n\r\nconst Info = styled.div`\r\n  flex: 3;\r\n`;\r\n\r\nconst Product = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  margin-bottom: 20px;\r\n  gap: 15px;\r\n  \r\n  @media (max-width: 768px) {\r\n    flex-direction: column;\r\n    border: 1px solid #e0e0e0;\r\n    border-radius: 10px;\r\n    padding: 15px;\r\n  }\r\n`;\r\n\r\nconst ProductDetail = styled.div`\r\n  flex: 2;\r\n  display: flex;\r\n  gap: 15px;\r\n  \r\n  @media (max-width: 480px) {\r\n    flex-direction: column;\r\n    text-align: center;\r\n  }\r\n`;\r\n\r\nconst Image = styled.img`\r\n  width: 200px;\r\n  height: 200px;\r\n  object-fit: cover;\r\n  \r\n  @media (max-width: 768px) {\r\n    width: 150px;\r\n    height: 150px;\r\n  }\r\n  \r\n  @media (max-width: 480px) {\r\n    width: 100%;\r\n    max-width: 200px;\r\n    height: 150px;\r\n    margin: 0 auto;\r\n  }\r\n`;\r\n\r\nconst Details = styled.div`\r\n  padding: 10px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-around;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 15px 0;\r\n    gap: 10px;\r\n  }\r\n`;\r\n\r\nconst ProductName = styled.span`\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  \r\n  @media (max-width: 480px) {\r\n    font-size: 14px;\r\n  }\r\n`;\r\n\r\nconst ProductId = styled.span`\r\n  color: gray;\r\n  font-size: 12px;\r\n`;\r\n\r\nconst PriceDetail = styled.div`\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 15px;\r\n  \r\n  @media (max-width: 768px) {\r\n    flex-direction: row;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n`;\r\n\r\nconst ProductAmountContainer = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n`;\r\n\r\nconst ProductAmount = styled.div`\r\n  font-size: 20px;\r\n  margin: 0 10px;\r\n  \r\n  @media (max-width: 480px) {\r\n    font-size: 18px;\r\n  }\r\n`;\r\n\r\nconst ProductPrice = styled.div`\r\n  font-size: 24px;\r\n  font-weight: 200;\r\n  \r\n  @media (max-width: 480px) {\r\n    font-size: 20px;\r\n  }\r\n`;\r\n\r\nconst Hr = styled.hr`\r\n  background-color: #eee;\r\n  border: none;\r\n  height: 1px;\r\n  margin: 20px 0;\r\n`;\r\n\r\nconst Summary = styled.div`\r\n  flex: 1;\r\n  border: 0.5px solid lightgray;\r\n  border-radius: 10px;\r\n  padding: 20px;\r\n  height: fit-content;\r\n  \r\n  @media (max-width: 768px) {\r\n    margin-top: 20px;\r\n  }\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 15px;\r\n  }\r\n`;\r\n\r\nconst SummaryTitle = styled.h1`\r\n  font-weight: 200;\r\n  font-size: 1.5rem;\r\n  \r\n  @media (max-width: 480px) {\r\n    font-size: 1.25rem;\r\n  }\r\n`;\r\n\r\nconst SummaryItem = styled.div`\r\n  margin: 20px 0px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-weight: ${(props) => props.type === \"total\" && \"500\"};\r\n  font-size: ${(props) => props.type === \"total\" ? \"20px\" : \"16px\"};\r\n  \r\n  @media (max-width: 480px) {\r\n    margin: 15px 0px;\r\n    font-size: ${(props) => props.type === \"total\" ? \"18px\" : \"14px\"};\r\n  }\r\n`;\r\n\r\nconst SummaryItemText = styled.span``;\r\n\r\nconst SummaryItemPrice = styled.span``;\r\n\r\nconst Button = styled.button`\r\n  width: 100%;\r\n  padding: 15px;\r\n  background-color: black;\r\n  color: white;\r\n  font-weight: 600;\r\n  border: none;\r\n  cursor: pointer;\r\n  margin-top: 10px;\r\n  border-radius: 8px;\r\n  font-size: 16px;\r\n  min-height: 50px;\r\n  \r\n  &:disabled {\r\n    background-color: #ccc;\r\n    cursor: not-allowed;\r\n  }\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 12px;\r\n    font-size: 14px;\r\n    min-height: 44px;\r\n  }\r\n`;\r\n\r\nconst QuantityButton = styled.button`\r\n  width: 35px;\r\n  height: 35px;\r\n  border: 1px solid teal;\r\n  background-color: white;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 4px;\r\n  min-height: 35px;\r\n  \r\n  @media (max-width: 480px) {\r\n    width: 30px;\r\n    height: 30px;\r\n    font-size: 14px;\r\n  }\r\n`;\r\n\r\nconst EmptyCart = styled.div`\r\n  text-align: center;\r\n  padding: 50px;\r\n  font-size: 18px;\r\n  color: gray;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 30px 20px;\r\n    font-size: 16px;\r\n  }\r\n`;\r\n\r\nconst FreeShippingBadge = styled.span`\r\n  color: green;\r\n  margin-left: 5px;\r\n  font-size: 12px;\r\n  font-weight: 600;\r\n`;\r\n\r\nconst AddressSection = styled.div`\r\n  margin: 20px 0;\r\n  padding: 20px;\r\n  border: 1px solid #eee;\r\n  border-radius: 10px;\r\n  background-color: #f9f9f9;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 15px;\r\n  }\r\n`;\r\n\r\nconst AddressSelector = styled.div`\r\n  margin-bottom: 15px;\r\n`;\r\n\r\nconst AddressOption = styled.div`\r\n  padding: 12px;\r\n  border: 2px solid ${props => props.selected ? '#667eea' : '#e2e8f0'};\r\n  border-radius: 8px;\r\n  margin-bottom: 10px;\r\n  cursor: pointer;\r\n  background: white;\r\n  transition: all 0.3s ease;\r\n\r\n  &:hover {\r\n    border-color: #667eea;\r\n  }\r\n`;\r\n\r\nconst AddressText = styled.p`\r\n  margin: 5px 0;\r\n  color: #2d3748;\r\n  line-height: 1.4;\r\n`;\r\n\r\nconst AddressType = styled.span`\r\n  background: ${props => props.isDefault ? '#667eea' : '#e2e8f0'};\r\n  color: ${props => props.isDefault ? 'white' : '#4a5568'};\r\n  padding: 4px 8px;\r\n  border-radius: 4px;\r\n  font-size: 0.8rem;\r\n  font-weight: 600;\r\n  margin-right: 10px;\r\n`;\r\n\r\nconst NewAddressButton = styled.button`\r\n  background: #e2e8f0;\r\n  color: #4a5568;\r\n  border: none;\r\n  padding: 10px 15px;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  margin-top: 10px;\r\n\r\n  &:hover {\r\n    background: #cbd5e0;\r\n  }\r\n`;\r\n\r\nconst Input = styled.input`\r\n  width: 100%;\r\n  padding: 12px;\r\n  margin: 8px 0;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  font-size: 14px;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 10px;\r\n    font-size: 16px;\r\n  }\r\n`;\r\n\r\nconst InputRow = styled.div`\r\n  display: flex;\r\n  gap: 10px;\r\n  \r\n  @media (max-width: 768px) {\r\n    flex-direction: column;\r\n  }\r\n`;\r\n\r\nconst InputGroup = styled.div`\r\n  flex: 1;\r\n`;\r\n\r\nconst PaymentModal = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  z-index: 1000;\r\n  padding: 20px;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 10px;\r\n    align-items: flex-start;\r\n    padding-top: 50px;\r\n  }\r\n`;\r\n\r\nconst PaymentContent = styled.div`\r\n  background: white;\r\n  padding: 2rem;\r\n  border-radius: 12px;\r\n  width: 90%;\r\n  max-width: 500px;\r\n  text-align: center;\r\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\r\n  max-height: 90vh;\r\n  overflow-y: auto;\r\n  \r\n  @media (max-width: 480px) {\r\n    padding: 1.5rem;\r\n    max-height: 80vh;\r\n  }\r\n`;\r\n\r\nconst PayNowBtn = styled.button`\r\n  background: #4CAF50;\r\n  color: white;\r\n  padding: 12px 24px;\r\n  border: none;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  margin: 5px;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  width: 100%;\r\n  transition: background 0.3s;\r\n\r\n  &:hover {\r\n    background: #45a049;\r\n  }\r\n\r\n  &:disabled {\r\n    background: #cccccc;\r\n    cursor: not-allowed;\r\n  }\r\n`;\r\n\r\nconst CancelBtn = styled.button`\r\n  background: #f44336;\r\n  color: white;\r\n  padding: 12px 24px;\r\n  border: none;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  margin: 5px;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  width: 100%;\r\n  transition: background 0.3s;\r\n\r\n  &:hover {\r\n    background: #da190b;\r\n  }\r\n`;\r\n\r\nconst ErrorMessage = styled.div`\r\n  color: #d32f2f;\r\n  background-color: #ffebee;\r\n  padding: 12px;\r\n  border-radius: 6px;\r\n  margin: 15px 0;\r\n  font-size: 14px;\r\n  border: 1px solid #f5c6cb;\r\n`;\r\n\r\nconst SuccessMessage = styled.div`\r\n  color: #155724;\r\n  background-color: #d4edda;\r\n  padding: 12px;\r\n  border-radius: 6px;\r\n  margin: 15px 0;\r\n  font-size: 14px;\r\n  border: 1px solid #c3e6cb;\r\n`;\r\n\r\nconst CardFormContainer = styled.div`\r\n  margin: 20px 0;\r\n  text-align: left;\r\n`;\r\n\r\nconst CardFieldContainer = styled.div`\r\n  margin-bottom: 15px;\r\n`;\r\n\r\nconst CardFieldLabel = styled.label`\r\n  display: block;\r\n  margin-bottom: 5px;\r\n  font-weight: 600;\r\n  color: #333;\r\n  font-size: 14px;\r\n`;\r\n\r\nconst CardFieldWrapper = styled.div`\r\n  padding: 12px;\r\n  border: 2px solid #e1e5e9;\r\n  border-radius: 8px;\r\n  background: white;\r\n  transition: border-color 0.3s;\r\n  \r\n  &:focus-within {\r\n    border-color: #4CAF50;\r\n    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);\r\n  }\r\n`;\r\n\r\nconst CardRow = styled.div`\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: 15px;\r\n  \r\n  @media (max-width: 480px) {\r\n    grid-template-columns: 1fr;\r\n  }\r\n`;\r\n\r\nconst LoadingSpinner = styled.div`\r\n  text-align: center;\r\n  padding: 20px;\r\n  color: #666;\r\n`;\r\n\r\n\r\n// ========== STRIPE PAYMENT FORM COMPONENT ==========\r\nconst StripePaymentForm = ({ amount, clientSecret, onSuccess, onError }) => {\r\n  // ... (keep your existing StripePaymentForm component exactly as it is)\r\n};\r\n\r\n// ========== MAIN CART PAGE COMPONENT ==========\r\nconst CartPage = () => {\r\n  const [cartItems, setCartItems] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [isCheckingOut, setIsCheckingOut] = useState(false);\r\n  const [showAddressSection, setShowAddressSection] = useState(false);\r\n  const [showPayment, setShowPayment] = useState(false);\r\n  const [paymentError, setPaymentError] = useState('');\r\n  const [paymentSuccess, setPaymentSuccess] = useState('');\r\n  const [clientSecret, setClientSecret] = useState('');\r\n  const [currentOrderId, setCurrentOrderId] = useState('');\r\n  const [userAddresses, setUserAddresses] = useState([]);\r\n  const [selectedAddress, setSelectedAddress] = useState(null);\r\n  const [showNewAddressForm, setShowNewAddressForm] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const [newAddress, setNewAddress] = useState({\r\n    street: \"\",\r\n    city: \"\",\r\n    state: \"\",\r\n    zipCode: \"\",\r\n    country: \"United States\",\r\n    type: \"home\",\r\n    isDefault: false\r\n  });\r\n\r\n  // Helper Functions\r\n  const getAuthHeader = () => {\r\n    const token = localStorage.getItem('token');\r\n    return token ? { Authorization: `Bearer ${token}` } : {};\r\n  };\r\n\r\n  const getCurrentUser = () => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      try {\r\n        const base64Payload = token.split('.')[1];\r\n        const payload = JSON.parse(atob(base64Payload));\r\n        return payload.userId;\r\n      } catch (error) {\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const calculateShipping = () => {\r\n    const subtotal = getTotal();\r\n    if (subtotal >= 50) {\r\n      return { shipping: 0, hasFreeShipping: true };\r\n    } else {\r\n      return { shipping: 5.90, hasFreeShipping: false };\r\n    }\r\n  };\r\n\r\n  const getTotal = () => {\r\n    return cartItems.reduce((total, item) => total + parseFloat(item.price) * item.quantity, 0);\r\n  };\r\n\r\n  const getFinalTotal = () => {\r\n    const shippingInfo = calculateShipping();\r\n    return getTotal() + shippingInfo.shipping;\r\n  };\r\n\r\n  // UPDATED: Reliable cart clearing function\r\n  const clearCartReliably = async (userId) => {\r\n    const token = localStorage.getItem('token');\r\n    const BASE_URL = process.env.REACT_APP_API_URL;\r\n    \r\n    console.log('🔄 Starting reliable cart clearing process...');\r\n    \r\n    // Strategy 1: Try backend API first\r\n    try {\r\n      console.log('🔄 Attempting backend cart clearing...');\r\n      const response = await axios.delete(\r\n        `${BASE_URL}/api/cart/${userId}/clear`,\r\n        { \r\n          headers: { Authorization: `Bearer ${token}` },\r\n          timeout: 5000\r\n        }\r\n      );\r\n      \r\n      if (response.data.message === 'Cart cleared successfully') {\r\n        console.log('✅ Backend cart cleared successfully');\r\n        return true;\r\n      }\r\n    } catch (backendError) {\r\n      console.warn('⚠️ Backend cart clearing failed, trying individual item removal:', backendError.message);\r\n      \r\n      // Strategy 2: Remove items one by one\r\n      try {\r\n        for (const item of cartItems) {\r\n          await axios.delete(\r\n            `${BASE_URL}/api/cart/${userId}/${item.productId}`,\r\n            { \r\n              headers: { Authorization: `Bearer ${token}` },\r\n              timeout: 3000\r\n            }\r\n          );\r\n          console.log(`✅ Removed item ${item.productId} from cart`);\r\n        }\r\n        console.log('✅ All items removed individually');\r\n        return true;\r\n      } catch (individualError) {\r\n        console.warn('⚠️ Individual item removal failed:', individualError.message);\r\n        \r\n        // Strategy 3: Update quantities to 0\r\n        try {\r\n          for (const item of cartItems) {\r\n            await axios.put(\r\n              `${BASE_URL}/api/cart/${userId}`,\r\n              { productId: item.productId, quantity: 0 },\r\n              { \r\n                headers: { Authorization: `Bearer ${token}` },\r\n                timeout: 3000\r\n              }\r\n            );\r\n          }\r\n          console.log('✅ All quantities set to 0');\r\n          return true;\r\n        } catch (quantityError) {\r\n          console.error('❌ All cart clearing strategies failed:', quantityError.message);\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  };\r\n\r\n  // Fetch user addresses from profile\r\n  const fetchUserAddresses = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const response = await axios.get(\r\n        `${process.env.REACT_APP_API_URL}/api/auth/addresses`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      const addresses = response.data.addresses || [];\r\n      setUserAddresses(addresses);\r\n      \r\n      // Auto-select default address\r\n      const defaultAddress = addresses.find(addr => addr.isDefault);\r\n      if (defaultAddress) {\r\n        setSelectedAddress(defaultAddress);\r\n      } else if (addresses.length > 0) {\r\n        setSelectedAddress(addresses[0]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching addresses:', error);\r\n    }\r\n  };\r\n\r\n  // Add new address to profile\r\n  const addNewAddress = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const response = await axios.post(\r\n        `${process.env.REACT_APP_API_URL}/api/auth/addresses`,\r\n        newAddress,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      // Refresh addresses\r\n      await fetchUserAddresses();\r\n      setShowNewAddressForm(false);\r\n      setNewAddress({\r\n        street: \"\",\r\n        city: \"\",\r\n        state: \"\",\r\n        zipCode: \"\",\r\n        country: \"United States\",\r\n        type: \"home\",\r\n        isDefault: false\r\n      });\r\n    } catch (error) {\r\n      console.error('Error adding address:', error);\r\n      alert('Failed to add address');\r\n    }\r\n  };\r\n\r\n  // Function to send payment confirmation email\r\n  const sendPaymentConfirmationEmail = async (orderData, paymentData) => {\r\n    try {\r\n      console.log('📧 Sending payment confirmation email for order:', orderData.id);\r\n      \r\n      const user = JSON.parse(localStorage.getItem('user'));\r\n      const userEmail = user?.email;\r\n\r\n      if (!userEmail) {\r\n        console.warn('No email found for payment confirmation');\r\n        return false;\r\n      }\r\n\r\n      const emailData = {\r\n        paymentData: {\r\n          id: paymentData.id,\r\n          orderId: orderData.id,\r\n          amount: orderData.amount,\r\n          paymentMethod: 'Credit Card',\r\n          status: 'completed',\r\n          paymentDate: new Date().toISOString(),\r\n          receiptUrl: `https://quickcart.com/receipts/${paymentData.id}`,\r\n          products: orderData.products,\r\n          shipping: orderData.shipping || 0,\r\n          tax: orderData.tax || 0\r\n        },\r\n        userEmail: userEmail\r\n      };\r\n\r\n      const response = await axios.post(\r\n        `${process.env.REACT_APP_API_URL}/api/email/payment-confirmation`,\r\n        emailData,\r\n        { headers: getAuthHeader() }\r\n      );\r\n\r\n      console.log('✅ Payment confirmation email sent successfully:', response.data);\r\n      return true;\r\n    } catch (emailError) {\r\n      console.error('❌ Failed to send payment confirmation email:', emailError);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Function to send order confirmation email\r\n  const sendOrderConfirmationEmail = async (orderData) => {\r\n    try {\r\n      console.log('📧 Sending order confirmation email for order:', orderData.id);\r\n      \r\n      const user = JSON.parse(localStorage.getItem('user'));\r\n      const userEmail = user?.email;\r\n\r\n      if (!userEmail) {\r\n        console.warn('No email found for order confirmation');\r\n        return false;\r\n      }\r\n\r\n      const emailData = {\r\n        orderData: orderData,\r\n        userEmail: userEmail\r\n      };\r\n\r\n      const response = await axios.post(\r\n        `${process.env.REACT_APP_API_URL}/api/email/order-confirmation`,\r\n        emailData,\r\n        { headers: getAuthHeader() }\r\n      );\r\n\r\n      console.log('✅ Order confirmation email sent successfully:', response.data);\r\n      return true;\r\n    } catch (emailError) {\r\n      console.error('❌ Failed to send order confirmation email:', emailError);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Clear payment flag function\r\n  const clearPaymentFlag = () => {\r\n    localStorage.removeItem('paymentCompleted');\r\n    console.log('🗑️ Payment flag cleared');\r\n  };\r\n\r\n  const fetchCart = useCallback(async () => {\r\n    const userId = getCurrentUser();\r\n    if (!userId) {\r\n      setCartItems([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      console.log('🔄 Fetching cart...');\r\n      const response = await axios.get(\r\n        `${process.env.REACT_APP_API_URL}/api/cart/${userId}`,\r\n        { headers: getAuthHeader() }\r\n      );\r\n      console.log('✅ Cart data received:', response.data.length, 'items');\r\n      setCartItems(response.data);\r\n    } catch (error) {\r\n      console.error('Error fetching cart:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const updateCartItem = async (productId, quantity) => {\r\n    const userId = getCurrentUser();\r\n    if (!userId) return;\r\n\r\n    try {\r\n      await axios.put(\r\n        `${process.env.REACT_APP_API_URL}/api/cart/${userId}`,\r\n        { productId, quantity },\r\n        { headers: getAuthHeader() }\r\n      );\r\n      await fetchCart();\r\n    } catch (error) {\r\n      console.error('Error updating cart:', error);\r\n    }\r\n  };\r\n\r\n  const removeFromCart = async (productId) => {\r\n    const userId = getCurrentUser();\r\n    if (!userId) return;\r\n\r\n    try {\r\n      await axios.delete(\r\n        `${process.env.REACT_APP_API_URL}/api/cart/${userId}/${productId}`,\r\n        { headers: getAuthHeader() }\r\n      );\r\n      await fetchCart();\r\n    } catch (error) {\r\n      console.error('Error removing from cart:', error);\r\n    }\r\n  };\r\n\r\n  // Clear payment flag on component mount and setup debug logging\r\n  useEffect(() => {\r\n    console.log('🔍 CartPage mounted, clearing payment flag');\r\n    clearPaymentFlag();\r\n    fetchCart();\r\n    fetchUserAddresses();\r\n  }, [fetchCart]);\r\n\r\n  // Debug cart updates\r\n  useEffect(() => {\r\n    console.log('📦 Cart items updated:', {\r\n      itemCount: cartItems.length,\r\n      items: cartItems,\r\n      paymentFlag: localStorage.getItem('paymentCompleted')\r\n    });\r\n  }, [cartItems]);\r\n\r\n  const handleQuantity = (productId, quantity) => {\r\n    if (quantity === 0) {\r\n      removeFromCart(productId);\r\n    } else {\r\n      updateCartItem(productId, quantity);\r\n    }\r\n  };\r\n\r\n  const handlePayment = async () => {\r\n    setPaymentError('');\r\n    setPaymentSuccess('');\r\n    setIsCheckingOut(true);\r\n\r\n    try {\r\n      const userId = getCurrentUser();\r\n      const token = localStorage.getItem('token');\r\n      const BASE_URL = process.env.REACT_APP_API_URL;\r\n\r\n      // Validate address first\r\n      if (!selectedAddress) {\r\n        throw new Error('Please select a shipping address');\r\n      }\r\n\r\n      // Validate cart items\r\n      if (cartItems.length === 0) {\r\n        throw new Error('Cart is empty');\r\n      }\r\n\r\n      console.log('🔄 Starting payment process...');\r\n      console.log('📦 Cart items:', cartItems);\r\n      console.log('🏠 Selected address:', selectedAddress);\r\n      console.log('💰 Total amount:', getFinalTotal());\r\n\r\n      // Step 1: Create order FIRST with proper data structure\r\n      const orderData = {\r\n        cartItems: cartItems.map(item => ({\r\n          productId: item.productId || item.id,\r\n          title: item.title || item.name,\r\n          price: parseFloat(item.price),\r\n          quantity: item.quantity,\r\n          size: item.size || 'One Size',\r\n          color: item.color || 'Default',\r\n          img: item.img || item.image\r\n        })),\r\n        address: selectedAddress,\r\n        totalAmount: getFinalTotal()\r\n      };\r\n\r\n      console.log('📦 Creating order with data:', orderData);\r\n\r\n      const orderResponse = await axios.post(\r\n        `${BASE_URL}/api/orders`,\r\n        orderData,\r\n        { \r\n          headers: { \r\n            Authorization: `Bearer ${token}`,\r\n            'Content-Type': 'application/json'\r\n          },\r\n          timeout: 10000\r\n        }\r\n      );\r\n\r\n      console.log('✅ Order creation response:', orderResponse.data);\r\n\r\n      if (!orderResponse.data.order || !orderResponse.data.order.id) {\r\n        throw new Error('Order creation failed - no order ID returned');\r\n      }\r\n\r\n      const createdOrderId = orderResponse.data.order.id;\r\n      setCurrentOrderId(createdOrderId);\r\n\r\n      console.log('✅ Order created successfully:', createdOrderId);\r\n\r\n      // Step 2: Create payment intent with the order ID\r\n      const amount = Math.round(getFinalTotal() * 100);\r\n\r\n      console.log('💳 Creating payment intent for amount:', amount);\r\n\r\n      const paymentResponse = await axios.post(\r\n        `${BASE_URL}/api/payments/create-payment-intent`,\r\n        { \r\n          orderId: createdOrderId,\r\n          amount: amount,\r\n          currency: 'usd'\r\n        },\r\n        { \r\n          headers: { \r\n            Authorization: `Bearer ${token}`,\r\n            'Content-Type': 'application/json'\r\n          },\r\n          timeout: 10000\r\n        }\r\n      );\r\n\r\n      console.log('✅ Payment intent response:', paymentResponse.data);\r\n\r\n      if (paymentResponse.data.clientSecret) {\r\n        console.log('✅ Payment intent created, client secret received');\r\n        setClientSecret(paymentResponse.data.clientSecret);\r\n      } else {\r\n        throw new Error('No client secret received from payment service');\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('❌ Payment setup error:', error);\r\n      const errorMessage = error.response?.data?.error || error.response?.data?.message || error.message;\r\n      setPaymentError(`Payment setup failed: ${errorMessage}`);\r\n      setIsCheckingOut(false);\r\n    }\r\n  };\r\n\r\n  // UPDATED: Reliable payment success handler\r\n  const handlePaymentSuccess = async (paymentIntent) => {\r\n    try {\r\n      const userId = getCurrentUser();\r\n      const token = localStorage.getItem('token');\r\n      const BASE_URL = process.env.REACT_APP_API_URL;\r\n      const userEmail = JSON.parse(localStorage.getItem('user'))?.email;\r\n\r\n      console.log('✅ Payment successful, paymentIntent:', paymentIntent);\r\n      \r\n      // STEP 1: CLEAR CART RELIABLY (MOST IMPORTANT)\r\n      console.log('🛒 Starting reliable cart clearing...');\r\n      const cartCleared = await clearCartReliably(userId);\r\n      \r\n      // STEP 2: Clear cart locally regardless of backend success\r\n      setCartItems([]);\r\n      console.log('✅ Cart cleared locally');\r\n      \r\n      if (!cartCleared) {\r\n        console.warn('⚠️ Backend cart clearing had issues, but continuing with payment success');\r\n      }\r\n\r\n      // STEP 3: Try to confirm payment with backend (optional)\r\n      let paymentConfirmed = false;\r\n      try {\r\n        const paymentConfirmation = await axios.post(\r\n          `${BASE_URL}/api/payments/confirm-payment`,\r\n          { \r\n            paymentIntentId: paymentIntent.id,\r\n            orderId: currentOrderId \r\n          },\r\n          { \r\n            headers: { Authorization: `Bearer ${token}` },\r\n            timeout: 10000\r\n          }\r\n        );\r\n\r\n        console.log('✅ Payment confirmed by backend:', paymentConfirmation.data);\r\n        paymentConfirmed = true;\r\n      } catch (confirmError) {\r\n        console.warn('⚠️ Payment confirmation API failed, but continuing:', confirmError.message);\r\n      }\r\n\r\n      // STEP 4: Verify order exists in database\r\n      let orderVerified = false;\r\n      try {\r\n        const orderVerification = await axios.get(\r\n          `${BASE_URL}/api/orders/${currentOrderId}`,\r\n          { \r\n            headers: { Authorization: `Bearer ${token}` },\r\n            timeout: 5000\r\n          }\r\n        );\r\n\r\n        if (orderVerification.data.order) {\r\n          orderVerified = true;\r\n          console.log('✅ Order verified in database:', orderVerification.data.order);\r\n        }\r\n      } catch (orderError) {\r\n        console.error('❌ Order verification failed:', orderError);\r\n      }\r\n\r\n      // STEP 5: Update order payment status if order exists\r\n      if (orderVerified) {\r\n        try {\r\n          const orderUpdateResponse = await axios.put(\r\n            `${BASE_URL}/api/orders/${currentOrderId}/payment-status`,\r\n            { \r\n              paymentStatus: 'paid'\r\n            },\r\n            { \r\n              headers: { Authorization: `Bearer ${token}` },\r\n              timeout: 5000\r\n            }\r\n          );\r\n          console.log('✅ Order payment status updated:', orderUpdateResponse.data);\r\n        } catch (orderError) {\r\n          console.error('⚠️ Order status update failed:', orderError);\r\n        }\r\n      }\r\n\r\n      // STEP 6: Prepare success data\r\n      const orderDataForSuccess = {\r\n        id: currentOrderId,\r\n        amount: getFinalTotal().toFixed(2),\r\n        products: cartItems.map(item => ({\r\n          title: item.title || item.name,\r\n          price: item.price,\r\n          quantity: item.quantity,\r\n          img: item.img || item.image,\r\n          size: item.size,\r\n          color: item.color\r\n        })),\r\n        address: selectedAddress,\r\n        paymentMethod: 'Credit Card',\r\n        status: 'confirmed',\r\n        paymentStatus: 'paid',\r\n        createdAt: new Date().toISOString(),\r\n        paymentIntentId: paymentIntent.id,\r\n        shipping: calculateShipping().shipping,\r\n        tax: 0\r\n      };\r\n\r\n      localStorage.setItem('lastOrder', JSON.stringify(orderDataForSuccess));\r\n      if (userEmail) {\r\n        localStorage.setItem('userEmail', userEmail);\r\n      }\r\n\r\n      // STEP 7: SEND EMAILS (non-blocking)\r\n      console.log('📧 Sending emails...');\r\n      Promise.all([\r\n        sendPaymentConfirmationEmail(orderDataForSuccess, paymentIntent),\r\n        sendOrderConfirmationEmail(orderDataForSuccess)\r\n      ]).then(([paymentEmailSent, orderEmailSent]) => {\r\n        console.log('📧 Email status:', {\r\n          paymentEmail: paymentEmailSent ? '✅ Sent' : '❌ Failed',\r\n          orderEmail: orderEmailSent ? '✅ Sent' : '❌ Failed'\r\n        });\r\n      }).catch(emailError => {\r\n        console.error('📧 Email sending error:', emailError);\r\n      });\r\n\r\n      console.log('🎉 Payment completed successfully, redirecting...');\r\n\r\n      // STEP 8: Set flag to prevent cart refetching\r\n      localStorage.setItem('paymentCompleted', 'true');\r\n      localStorage.setItem('lastCartClearTime', Date.now().toString());\r\n\r\n      // STEP 9: Show success message and redirect\r\n      setPaymentSuccess('Payment successful! Cart cleared. Redirecting...');\r\n      \r\n      setTimeout(() => {\r\n        setShowPayment(false);\r\n        setClientSecret('');\r\n        navigate('/success');\r\n      }, 1500);\r\n\r\n    } catch (error) {\r\n      console.error('❌ Post-payment processing error:', error);\r\n      const errorMessage = error.response?.data?.error || error.message;\r\n      \r\n      // Even if there are issues, if payment was successful with Stripe, proceed\r\n      if (paymentIntent.status === 'succeeded') {\r\n        console.log('⚠️ Minor issues but Stripe payment succeeded, proceeding...');\r\n        \r\n        // Clear cart locally anyway as fallback\r\n        setCartItems([]);\r\n        localStorage.setItem('paymentCompleted', 'true');\r\n        localStorage.setItem('lastCartClearTime', Date.now().toString());\r\n        \r\n        setPaymentSuccess('Payment successful! Minor processing issues. Redirecting...');\r\n        \r\n        setTimeout(() => {\r\n          setShowPayment(false);\r\n          setClientSecret('');\r\n          navigate('/success');\r\n        }, 1500);\r\n      } else {\r\n        setPaymentError(`Payment processing failed: ${errorMessage}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handlePaymentError = (errorMessage) => {\r\n    console.error('❌ Payment error:', errorMessage);\r\n    setPaymentError(`Payment failed: ${errorMessage}`);\r\n  };\r\n\r\n  const handleCheckout = () => {\r\n    if (cartItems.length === 0) {\r\n      alert('Your cart is empty');\r\n      return;\r\n    }\r\n    \r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      alert('Please login to checkout');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    if (!showAddressSection) {\r\n      setShowAddressSection(true);\r\n      return;\r\n    }\r\n\r\n    // Validate address before proceeding to payment\r\n    if (!selectedAddress) {\r\n      alert('Please select a shipping address');\r\n      return;\r\n    }\r\n\r\n    setShowPayment(true);\r\n    handlePayment(); // Start the payment process\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setNewAddress(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n\r\n  const handleContinueShopping = () => {\r\n    // Clear payment flag when user continues shopping\r\n    clearPaymentFlag();\r\n    navigate('/');\r\n  };\r\n\r\n  const handleManageAddresses = () => {\r\n    navigate('/addresses');\r\n  };\r\n\r\n  const shippingInfo = calculateShipping();\r\n\r\n  if (loading) {\r\n    return (\r\n      <Container>\r\n        <Wrapper>\r\n          <Title>YOUR BAG</Title>\r\n          <div style={{ textAlign: 'center', padding: '50px' }}>Loading cart...</div>\r\n        </Wrapper>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Container>\r\n      <Wrapper>\r\n        <Title>YOUR BAG</Title>\r\n        <Top>\r\n          <TopButton onClick={handleContinueShopping}>CONTINUE SHOPPING</TopButton>\r\n          <TopTexts>\r\n            <TopText>Shopping Bag({cartItems.length})</TopText>\r\n            <TopText>Your Wishlist (0)</TopText>\r\n          </TopTexts>\r\n          <TopButton \r\n            type=\"filled\" \r\n            onClick={handleCheckout}\r\n            disabled={cartItems.length === 0}\r\n          >\r\n            {isCheckingOut ? 'PROCESSING...' : 'CHECKOUT NOW'}\r\n          </TopButton>\r\n        </Top>\r\n        <Bottom>\r\n          <Info>\r\n            {cartItems.length === 0 ? (\r\n              <EmptyCart>\r\n                <h3>Your cart is empty</h3>\r\n                <p>Add some products to your cart to see them here</p>\r\n                <TopButton onClick={handleContinueShopping} style={{ marginTop: '20px' }}>\r\n                  START SHOPPING\r\n                </TopButton>\r\n              </EmptyCart>\r\n            ) : (\r\n              cartItems.map((item) => (\r\n                <div key={item.id}>\r\n                  <Product>\r\n                    <ProductDetail>\r\n                      <Image src={item.img || 'https://via.placeholder.com/200x200?text=No+Image'} />\r\n                      <Details>\r\n                        <ProductName>\r\n                          <b>Product:</b> {item.title}\r\n                        </ProductName>\r\n                        <ProductId>\r\n                          <b>ID:</b> {item.productId}\r\n                        </ProductId>\r\n                        {item.size && (\r\n                          <div>\r\n                            <b>Size:</b> {item.size}\r\n                          </div>\r\n                        )}\r\n                        {item.color && (\r\n                          <div>\r\n                            <b>Color:</b> {item.color}\r\n                          </div>\r\n                        )}\r\n                      </Details>\r\n                    </ProductDetail>\r\n                    <PriceDetail>\r\n                      <ProductAmountContainer>\r\n                        <QuantityButton onClick={() => handleQuantity(item.productId, item.quantity - 1)}>\r\n                          -\r\n                        </QuantityButton>\r\n                        <ProductAmount>{item.quantity}</ProductAmount>\r\n                        <QuantityButton onClick={() => handleQuantity(item.productId, item.quantity + 1)}>\r\n                          +\r\n                        </QuantityButton>\r\n                      </ProductAmountContainer>\r\n                      <ProductPrice>$ {(parseFloat(item.price) * item.quantity).toFixed(2)}</ProductPrice>\r\n                    </PriceDetail>\r\n                  </Product>\r\n                  <Hr />\r\n                </div>\r\n              ))\r\n            )}\r\n          </Info>\r\n          {cartItems.length > 0 && (\r\n            <Summary>\r\n              <SummaryTitle>ORDER SUMMARY</SummaryTitle>\r\n              <SummaryItem>\r\n                <SummaryItemText>Subtotal</SummaryItemText>\r\n                <SummaryItemPrice>$ {getTotal().toFixed(2)}</SummaryItemPrice>\r\n              </SummaryItem>\r\n              \r\n              <SummaryItem>\r\n                <SummaryItemText>\r\n                  Shipping\r\n                  {shippingInfo.hasFreeShipping && (\r\n                    <FreeShippingBadge>🚚 FREE</FreeShippingBadge>\r\n                  )}\r\n                </SummaryItemText>\r\n                <SummaryItemPrice>\r\n                  {shippingInfo.hasFreeShipping ? '$ 0.00' : `$ ${shippingInfo.shipping.toFixed(2)}`}\r\n                </SummaryItemPrice>\r\n              </SummaryItem>\r\n\r\n              {!shippingInfo.hasFreeShipping && (\r\n                <SummaryItem>\r\n                  <SummaryItemText style={{ fontSize: '12px', color: '#666', fontStyle: 'italic' }}>\r\n                    Add ${(50 - getTotal()).toFixed(2)} more for free shipping!\r\n                  </SummaryItemText>\r\n                  <SummaryItemPrice></SummaryItemPrice>\r\n                </SummaryItem>\r\n              )}\r\n\r\n              <SummaryItem type=\"total\">\r\n                <SummaryItemText>Total</SummaryItemText>\r\n                <SummaryItemPrice>$ {getFinalTotal().toFixed(2)}</SummaryItemPrice>\r\n              </SummaryItem>\r\n\r\n              {showAddressSection && (\r\n                <AddressSection>\r\n                  <h3>Shipping Address</h3>\r\n                  \r\n                  {userAddresses.length > 0 ? (\r\n                    <AddressSelector>\r\n                      <p>Select a saved address:</p>\r\n                      {userAddresses.map((address) => (\r\n                        <AddressOption \r\n                          key={address.id}\r\n                          selected={selectedAddress?.id === address.id}\r\n                          onClick={() => setSelectedAddress(address)}\r\n                        >\r\n                          <div>\r\n                            <AddressType isDefault={address.isDefault}>\r\n                              {address.type} {address.isDefault && '(Default)'}\r\n                            </AddressType>\r\n                          </div>\r\n                          <AddressText>{address.street}</AddressText>\r\n                          <AddressText>{address.city}, {address.state} {address.zipCode}</AddressText>\r\n                          <AddressText>{address.country}</AddressText>\r\n                        </AddressOption>\r\n                      ))}\r\n                    </AddressSelector>\r\n                  ) : (\r\n                    <p>No saved addresses found.</p>\r\n                  )}\r\n\r\n                  {!showNewAddressForm ? (\r\n                    <div>\r\n                      <NewAddressButton onClick={() => setShowNewAddressForm(true)}>\r\n                        + Add New Address\r\n                      </NewAddressButton>\r\n                      <NewAddressButton onClick={handleManageAddresses} style={{ marginLeft: '10px' }}>\r\n                        📋 Manage Addresses\r\n                      </NewAddressButton>\r\n                    </div>\r\n                  ) : (\r\n                    <div>\r\n                      <h4>Add New Address</h4>\r\n                      <Input\r\n                        type=\"text\"\r\n                        name=\"street\"\r\n                        placeholder=\"Street Address\"\r\n                        value={newAddress.street}\r\n                        onChange={handleInputChange}\r\n                        required\r\n                      />\r\n                      <InputRow>\r\n                        <InputGroup>\r\n                          <Input\r\n                            type=\"text\"\r\n                            name=\"city\"\r\n                            placeholder=\"City\"\r\n                            value={newAddress.city}\r\n                            onChange={handleInputChange}\r\n                            required\r\n                          />\r\n                        </InputGroup>\r\n                        <InputGroup>\r\n                          <Input\r\n                            type=\"text\"\r\n                            name=\"state\"\r\n                            placeholder=\"State\"\r\n                            value={newAddress.state}\r\n                            onChange={handleInputChange}\r\n                            required\r\n                          />\r\n                        </InputGroup>\r\n                      </InputRow>\r\n                      <InputRow>\r\n                        <InputGroup>\r\n                          <Input\r\n                            type=\"text\"\r\n                            name=\"zipCode\"\r\n                            placeholder=\"ZIP Code\"\r\n                            value={newAddress.zipCode}\r\n                            onChange={handleInputChange}\r\n                            required\r\n                          />\r\n                        </InputGroup>\r\n                        <InputGroup>\r\n                          <Input\r\n                            type=\"text\"\r\n                            name=\"country\"\r\n                            placeholder=\"Country\"\r\n                            value={newAddress.country}\r\n                            onChange={handleInputChange}\r\n                            required\r\n                          />\r\n                        </InputGroup>\r\n                      </InputRow>\r\n                      <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>\r\n                        <NewAddressButton onClick={addNewAddress}>\r\n                          Save Address\r\n                        </NewAddressButton>\r\n                        <NewAddressButton onClick={() => setShowNewAddressForm(false)}>\r\n                          Cancel\r\n                        </NewAddressButton>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </AddressSection>\r\n              )}\r\n\r\n              <Button \r\n                onClick={handleCheckout}\r\n                disabled={cartItems.length === 0 || isCheckingOut || (showAddressSection && !selectedAddress)}\r\n                style={{\r\n                  backgroundColor: cartItems.length === 0 ? '#ccc' : isCheckingOut ? '#ffa500' : '#000'\r\n                }}\r\n              >\r\n                {isCheckingOut ? '🔄 PROCESSING...' : \r\n                 showAddressSection ? '💳 PROCEED TO PAYMENT' : \r\n                 `🛒 CHECKOUT NOW ($${getFinalTotal().toFixed(2)})`}\r\n              </Button>\r\n            </Summary>\r\n          )}\r\n        </Bottom>\r\n      </Wrapper>\r\n\r\n      {showPayment && (\r\n        <PaymentModal>\r\n          <PaymentContent>\r\n            <h2 style={{ marginBottom: '10px', color: '#333' }}>Complete Your Purchase</h2>\r\n            <p style={{ fontSize: '18px', fontWeight: '600', color: '#2c5aa0', marginBottom: '20px' }}>\r\n              Total Amount: <span style={{ color: '#4CAF50' }}>${getFinalTotal().toFixed(2)}</span>\r\n            </p>\r\n            \r\n            {paymentError && (\r\n              <ErrorMessage>\r\n                <strong>Payment Error:</strong> {paymentError}\r\n                <br />\r\n                <small>Please check your address information and try again.</small>\r\n              </ErrorMessage>\r\n            )}\r\n            {paymentSuccess && <SuccessMessage>{paymentSuccess}</SuccessMessage>}\r\n            \r\n            {!clientSecret && isCheckingOut && (\r\n              <LoadingSpinner>\r\n                <div style={{ marginBottom: '10px' }}>🔄 Setting up payment...</div>\r\n                <div style={{ fontSize: '14px', color: '#666' }}>\r\n                  Creating order and payment session...\r\n                </div>\r\n              </LoadingSpinner>\r\n            )}\r\n            \r\n            {clientSecret ? (\r\n              <Elements stripe={stripePromise} options={{ clientSecret }}>\r\n                <StripePaymentForm \r\n                  amount={getFinalTotal().toFixed(2)}\r\n                  clientSecret={clientSecret}\r\n                  onSuccess={handlePaymentSuccess}\r\n                  onError={handlePaymentError}\r\n                />\r\n              </Elements>\r\n            ) : (\r\n              !isCheckingOut && (\r\n                <div>\r\n                  <PayNowBtn \r\n                    onClick={handlePayment} \r\n                    disabled={isCheckingOut}\r\n                  >\r\n                    {isCheckingOut ? 'Setting Up Payment...' : 'Try Payment Again'}\r\n                  </PayNowBtn>\r\n                </div>\r\n              )\r\n            )}\r\n            \r\n            <CancelBtn onClick={() => {\r\n              setShowPayment(false);\r\n              setClientSecret('');\r\n              setPaymentError('');\r\n              setPaymentSuccess('');\r\n              setIsCheckingOut(false);\r\n            }}>\r\n              Cancel Payment\r\n            </CancelBtn>\r\n          </PaymentContent>\r\n        </PaymentModal>\r\n      )}\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default CartPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}